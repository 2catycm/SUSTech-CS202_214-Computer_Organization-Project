# 南科图智 简易Verilog FPGA 代码编写规范 
叶璨铭， 12011404@mail.sustech.edu.cn
[TOC]
## 0. 前言

### 0.0 什么是代码规范？为什么要有Verilog代码规范？

代码规范是指对代码的命名习惯、编写风格，代码文件的储存方式、组织方式的指导性规定。

好的代码规范可以避免不必要的重复劳动，从而提高设计效率[^3]。良好的代码规范对Verilog开发设计的帮助主要体现在一下几个方面：

- 遵循规范编写的代码，可读性较高
  - 这样不仅提高了硬件代码设计人员的工作效率，也帮助在调试复杂系统时发现和分析他人代码和自己编写代码存在的问题。[^3]
- 遵循规范编写的代码，可扩展性较好
  - 严格遵守统一规范编写的硬件代码，容易修改[^3]
  - 可以显著提高开发团队整体的设计效率，节省人力资源。[^3]
- 遵循规范编写的代码，可以被绝大多数仿真和综合工具所接受。
  - 大大减少代码在不同设计、综合和仿真平台之间迁移的工作量[^3]

在git协作开发过程中，一旦发现任何不符合规范的代码，负责模块验收和CodeReview的人员有义务向设计者提出不符合规范的地方，令其及时做出修正。[^3]不能因为通过系统测试而忽视规范, 否则，“屎山”越堆越大，将导致后期无法重构。

当然，本规范也不是”放之四海而皆准“。对于特殊情况，可以具体问题具体分析。

### 0.1 为什么编写本文档？

本文档规定了南科大图灵班CS214 CPU设计小组进行电路描述时推荐遵守的代码规范。

本文档主要是对网上的一些Verilog设计规范，结合本小组的开发实践经验，结合CS214大作业的设计要求，进行的整理与简化。除了网上规范提到的Verilog语法，本文档还对文件、文件夹组织有独到的见解。

## 1. 基本约定
### 1.0 文件编码

- 文件编码：对于国人为主要开发者的项目，使用**GBK编码**，理由如下
  - Vivado方便性：
  - VsCode方便性：
  - 编码大小：GBK
- 如何正确使用GBK编码？
  - 实际开发中，常常出现推送到git分支后文件编码乱码，在其他人电脑无法显示的问题。
  - 

### 1.1 文件夹与文件夹结构


### 1.2 

## 2. Verilog 编程规范

### 2.0 文件夹与Vivado

### 2.1 文件
- 文件的概念
  - 是模块的集合，一个文件包括多个模块。
  - 约定：
    - 文件对外暴露一个公共模块，该模块可以被其他文件的模块例化。
    - 文件内其他模块仅能在文件内进行例化。
  - 理由：借鉴Java编程规范。这样能够实现高内聚（私有模块只在文件内可见、互相调用）低耦合（文件之间的关系最多涉及一个模块）。


#### 2.1.0 文件名

- 约定：文件名应该与公共模块名一致。
- 理由：借鉴Java编程规范。这样能够让看到文件的人一目了然。

#### 2.1.1 文件头注释

- 禁止使用vivado自带注释。
- 使用短而有效的注释。

### 2.2 模块

- 模块的概念。
  - 模块是对输入信号进行组织、连接，不断提供输出信号的电路抽象层次。
  - 模块类似于一个类，可以被实例化。
  - 有成员变量，并且可以分为输入和输出两种变量，对应只写/只读成员变量。
  - 成员函数/方法通过使能信号来实现。

#### 2.1.0 文件名模块名

- 大写驼峰
- 理由：对应Java类。

#### 2.1.1 模块例化

- 模块例化在Verilog中有两种风格，
  - 类似C语言结构体的.绑定
  - 类似函数调用的顺序绑定。
- 约定：禁止使用顺序绑定
- 理由：
  - 基本原则：重构在软件开发中非常重要。我们主要考虑重构的方便性。

#### 2.1.2 模块输入输出端口

- 模块输入输出在Verilog中有两种风格，
  - 

### 2.2 变量（包含信号）

所有信号采用 **小驼峰** 命名方式。[^2] 

- 其中部分信号添加前缀。
- 管脚绑定信号属于宏定义、常数的命名方式，特殊处理。

#### 2.2.0 模块输入输出端口 的命名风格

- 命名：i/o+大写驼峰
  - 例子：
  - 理由：对应类的只写/只读成员变量
  - 参考资料[^2] 
  - 例外，管脚约束变量使用 **大写下划线**分割大单词，**大写驼峰**分割小单词。

#### 2.2.1 局部变量

- 为了进行连线，局部往往产生wire类型的中间变量。

- 约定：使用**小写驼峰**
- 类似于软件编程语言的函数内局部变量。
  - 可以认为我们对Verilog模块编写的所有代码，都是在对类进行构造。我们在一个构造函数中。

- - 

#### 2.2.2 数据变量

- 为了进行数据、状态的保存，往往局部使用reg类型
- 约定：使用**d+大写驼峰**，d表示data(数据)。

#### 2.2.3 模块例化变量

模块例化

- 例化相当于是面向对象的组合，描述了一种绑定关系。
- 例化的同时，子模块会有自己的数据状态，因此例化可以视作例化者自身通过例化被例化的模块获得了数据变量。
- 因此例化也是用**d+大写驼峰**的格式。

## 参考文献
[^1]: 华为大规模逻辑设计指导书.pdf

[^2]: [Zion Verilog Code Style](https://verilogcodingstyle.readthedocs.io/en/latest/source/1BasicSyntax_cn.html) ([github](https://github.com/zion-group/VerilogCodingStyle)上开源)

[^3]: [高通绝密VERILOG 编码规范](https://www.docin.com/p-1308800576.html#:~:text=Verilog%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E8%BD%AFIP%E9%87%8D%E7%94%A8%E6%A0%87%E5%87%86%EF%BC%88%E8%8D%89%E6%A1%88%202011-1-10%EF%BC%89%20%EF%BC%88%E4%BB%85%E4%BE%9B%E9%AB%98%E9%80%9A%E5%86%85%E9%83%A8%E4%BD%BF%E7%94%A8%EF%BC%89%20%E5%AE%97%E6%97%A8%E6%9C%AC%E8%A7%84%E8%8C%83%E4%B8%BA%E5%85%AC%E5%8F%B8%E5%86%85%E9%83%A8%E5%BC%BA%E5%88%B6%E5%AE%9E%E6%96%BD%E7%9A%84%20Verilog%20HDL%20%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E3%80%82.,%E6%AF%8F%E4%B8%AAIP%E8%AE%BE%E8%AE%A1%E4%BA%BA%E5%91%98%E5%BF%85%E9%A1%BB%E4%B8%A5%E6%A0%BC%E9%81%B5%E5%AE%88%EF%BC%8C%E4%BB%A5%20%E9%81%BF%E5%85%8D%E4%B8%8D%E5%BF%85%E8%A6%81%E7%9A%84%E9%87%8D%E5%A4%8D%E5%8A%B3%E5%8A%A8%EF%BC%8C%E4%BB%8E%E8%80%8C%E6%8F%90%E9%AB%98%E8%AE%BE%E8%AE%A1%E6%95%88%E7%8E%87%E3%80%82.%20%E6%9C%AC%E8%A7%84%E8%8C%83%E9%80%82%E7%94%A8%E4%BA%8E%E4%B8%8B%E5%88%97%E4%B8%89%E7%A7%8D%20Verilog%E4%BB%A3%E7%A0%81%E6%96%87%E4%BB%B6%E7%9A%84%E7%BC%96%20%E5%86%99%EF%BC%9A1%EF%BC%89%E5%8F%AF%E7%BB%BC%E5%90%88%E9%80%BB%E8%BE%91%E9%83%A8%E4%BB%B6%EF%BC%9B2%EF%BC%89%E8%99%9A%E6%8B%9F%E9%83%A8%E4%BB%B6%EF%BC%88Virtual%20Component--VC%EF%BC%89%EF%BC%9B3%EF%BC%89%E6%B5%8B%E8%AF%95%E6%A8%A1%E5%9D%97%EF%BC%88testbenches%EF%BC%89%E3%80%82.%20%E8%A7%84%E8%8C%83%E8%BF%98%E5%AF%B9%E6%A8%A1%E5%9D%97%E6%96%87%E4%BB%B6%E7%9A%84%E5%91%BD%E5%90%8D%E4%B9%A0%E6%83%AF%E3%80%81%E4%BB%A3%E7%A0%81%E6%96%87%E4%BB%B6%E7%9A%84%E5%82%A8%E5%AD%98%E3%80%81%E4%BB%A3%E7%A0%81%E6%96%87%E4%BB%B6%E7%9A%84%E7%BC%96%E5%86%99%E9%A3%8E%E6%A0%BC%E5%81%9A%E4%BA%86%E5%BC%BA%E5%88%B6%E6%80%A7%E7%9A%84%E8%A7%84%E5%AE%9A%E3%80%82.%20%E5%85%AC%E5%8F%B8%E5%86%85%E7%9A%84%E6%AF%8F%E4%B8%AA%E8%AE%BE%E8%AE%A1%E4%BA%BA%E5%91%98%E5%BF%85%E9%A1%BB%E4%B8%A5%E6%A0%BC%E9%81%B5%E7%85%A7%E6%9C%AC%E8%A7%84%E8%8C%83%E6%9D%A5%E7%BC%96%E5%86%99%E4%BB%A3%E7%A0%81%EF%BC%8C%E4%BB%A5%E6%8F%90%E9%AB%98%E4%BB%A3%E7%A0%81%E7%9A%84%E5%8F%AF%E8%AF%BB%E6%80%A7%E3%80%82.)